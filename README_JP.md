# Base Escrow dApp

Baseブロックチェーン上で日本円（JPY）と暗号通貨の安全な対面取引を実現する分散型エスクローアプリケーション

## プロジェクト概要

Base Escrow dAppは、ハッカソン用に設計されたデモ専用アプリケーションで、現金（日本円）と暗号通貨の安全なピアツーピア取引を可能にします。信頼できる第三者を必要とせずに、物理的な現金とデジタルアセットを安全に交換できるトラストレスなエスクローサービスを提供します。

### 主要機能

- **セキュアなエスクローシステム**: 自動返金機能付きのスマートコントラクトベースのエスクロー
- **マルチアセット対応**: ETH、USDC、USDTのサポート
- **リアルタイム価格フィード**: 正確なJPY-暗号通貨変換のためのCoinMarketCap API統合
- **ワンタイムコード（OTC）システム**: 対面取引のための安全な検証メカニズム
- **モバイルファーストデザイン**: 直感的なUXでモバイルデバイスに最適化
- **Farcaster統合**: シームレスなソーシャルインタラクションのためのMini Appサポート

### 動作の流れ

1. **Maker**が暗号通貨を預け入れ、日本円の金額を指定してエスクローを作成
2. **Taker**がOTCコード付きのQRコードを受け取る
3. **対面取引**: 物理的な現金とOTCコードを交換
4. **Release**: MakerがOTCコードを使用して資金を解放
5. **自動返金**: 期限までに解放されない場合、資金は自動的に返金される

## 使用技術

### スマートコントラクト
- **Solidity 0.8.24**: スマートコントラクト開発
- **Hardhat**: 開発環境とテストフレームワーク
- **OpenZeppelin**: セキュリティ重視のスマートコントラクトライブラリ
  - ReentrancyGuard: リエントランシー攻撃からの保護
  - Ownable: アクセス制御
  - SafeERC20: 安全なトークン操作

### フロントエンド
- **Next.js 15.5.3**: App Router付きReactフレームワーク
- **TypeScript**: 型安全な開発
- **Tailwind CSS**: ユーティリティファーストCSSフレームワーク
- **Wagmi + Viem**: イーサリアムウォレット統合
- **OnchainKit**: Coinbaseウォレット統合
- **React Hot Toast**: ユーザー通知

### ブロックチェーン・API
- **Base Sepolia**: 開発用テストネットワーク
- **CoinMarketCap API**: リアルタイム暗号通貨価格データ
- **ERC-20トークン**: USDCとUSDTのサポート

### 開発ツール
- **Playwright**: エンドツーエンドテスト
- **ESLint**: コードリンティング
- **Vercel**: デプロイメントプラットフォーム

## 基本アーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   フロントエンド    │    │   スマート       │    │   外部サービス    │
│   (Next.js)     │    │   コントラクト    │    │                 │
│                 │    │   (Escrow.sol)  │    │                 │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • ウォレット接続  │◄──►│ • エスクローロジック│    │ • CoinMarketCap │
│ • 価格表示      │    │ • OTCシステム    │    │   API           │
│ • QRコード生成   │    │ • 自動返金       │    │ • Baseネットワーク│
│ • モバイルUI    │    │ • マルチトークン  │    │ • Farcaster     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### スマートコントラクトアーキテクチャ

`Escrow.sol`コントラクトは以下を実装：

- **エスクロー管理**: 作成、解放、返金操作
- **セキュリティ機能**: リエントランシー保護、アクセス制御
- **マルチトークンサポート**: 適切なERC-20処理によるETH、USDC、USDT
- **OTC検証**: ワンタイムコードの暗号学的検証
- **期限管理**: 期限切れ後の自動返金

### フロントエンドアーキテクチャ

- **ページ**: ホーム、新規エスクロー、セッション管理、ログ
- **コンポーネント**: 再利用性のためのモジュラーUIコンポーネント
- **フック**: ブロックチェーン操作のためのカスタムReactフック
- **APIルート**: CORS処理のためのCoinMarketCapプロキシ

## ソースコード

- **リポジトリ**: [GitHubリポジトリ](https://github.com/your-username/base-escrow-dapp)
- **ライセンス**: MITライセンス（オープンソース）
- **スマートコントラクト**: `contracts/Escrow.sol`
- **フロントエンド**: Next.js構造の`src/`ディレクトリ

## デプロイメント

### デモデプロイ
- **ライブデモ**: [https://escrow-app-seven.vercel.app](https://escrow-app-seven.vercel.app)
- **Farcaster Mini App**: Farcasterプラットフォームで利用可能
- **ネットワーク**: Base Sepoliaテストネット

### コントラクトアドレス
- **エスクローコントラクト**: `0xA755f4c3e56c5ea2815c0013843fe9cf6d1762D4`
- **USDC**: `0x036CbD53842c5426634e7929541eC2318f3dCF7e`
- **USDT**: `0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb`

### ローカル開発

1. **リポジトリのクローン**
   ```bash
   git clone https://github.com/your-username/base-escrow-dapp.git
   cd base-escrow-dapp
   ```

2. **依存関係のインストール**
   ```bash
   npm install
   # または
   pnpm install
   ```

3. **環境変数の設定**
   ```bash
   cp .env.example .env.local
   # .env.localを編集してAPIキーとコントラクトアドレスを設定
   ```

4. **スマートコントラクトのコンパイル**
   ```bash
   npx hardhat compile
   ```

5. **コントラクトのデプロイ**
   ```bash
   npx hardhat run scripts/deploy.cjs --network baseSepolia
   ```

6. **開発サーバーの起動**
   ```bash
   npm run dev
   ```

### テスト

- **スマートコントラクトテスト**: `npx hardhat test`
- **E2Eテスト**: `npx playwright test`
- **カバレッジ**: `npx hardhat coverage`

## セキュリティ考慮事項

- **デモ専用**: このアプリケーションはハッカソン実演用に設計されています
- **テストネットのみ**: 現在はBase Sepoliaテストネットにのみデプロイされています
- **価格オラクル**: CoinMarketCap APIを使用（分散化されていない）
- **OTCシステム**: ワンタイムコードは対面取引の基本的なセキュリティを提供

## 今後の拡張計画

- **Chainlink統合**: 分散化された価格フィード
- **マルチチェーンサポート**: 他のEVM互換チェーンへの拡張
- **高度なセキュリティ**: マルチシグ要件
- **モバイルアプリ**: ネイティブモバイルアプリケーション
- **アナリティクス**: 取引分析とレポート

## 貢献

これはハッカソンプロジェクトです。本番環境での使用には、追加のセキュリティ監査とテストが必要です。

## ライセンス

MITライセンス - 詳細はLICENSEファイルを参照してください。
